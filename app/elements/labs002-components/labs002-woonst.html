<!-- Copyright (c) 2015 The Locals Project Authors. All rights reserved.
See authors.md for a list of all members.
 -->
<!-- 
 {
  "component": "labs002-woonst",
  "conditions": [
    {
      "objectname": "Avatar"
    }
  ],
  "config": {
    "gebouw": [
      0,
      "red"
    ]
  },
  "data": {
    "nummer": "0",
    "plaats": "plaats",
    "postcode": "0000",
    "straat": "straatnaam"
  },
  "description": "Lorem ipsum",
  "enabled": false,
  "hash": "0",
  "height": 20,
  "locked": false,
  "name": "Woonst",
  "version": "0.0.1",
  "width": 20
} -->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">

<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="labs002-avatar-backingpages.html">
<link rel="import" href="../lo-peers/lo-peers.html">
<link rel="import" href="lo-colorpicker.html">
<link rel="import" href="../lo-configbtns/lo-configbtns.html">
<link rel="import" href="labs002-avatar-woonstpages.html">

<dom-module id="labs002-woonst">
  <style>
   :host {
      display: block;
      height: 100%;
      width: 100%;
      --btns-visibility: hidden;
    }

    neon-animated-pages {
      height: 100%;
    }

    .canvas {
      height: 100%;
      width: 100%;
    }

    .whitebg {
      background-color: white;
    }

   .thumbcontainer {
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.1);
      position: relative;
      background-color: white;
      }

    .avatarcontainer {
      width: 100%;
      max-width: 400px; 
      height: 100vw;
      max-height: 400px; 
      position: relative;
      background: linear-gradient(to bottom, #a4facd 60%, white 40%); 
      @apply(--layout-vertical);
      @apply(--layout-center);
      }

    .avatarcanvas {
      width: 100%;  
      background: linear-gradient(to bottom, #a4facd 60%, white 40%); 
      @apply(--layout-vertical);
      @apply(--layout-center);
    }


    .absolutepos {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .objectvaluesbar {
      width: 100%;
      margin: 0px 0px 0px 0px;
      padding: 15px 15px 15px 20px;
      box-sizing:border-box;
      background-color: #F4F4F4;
      height: 60px;
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
      box-sizing:border-box;
      border-radius: 0px 0px 2px 2px;
    }

    .valids {
      @apply(--layout-horizontal);
      @apply(--layout-end-justified);
      @apply(--layout-center);
      width: 20%;
      min-width: 40px;
      height: 100%;
    }

    .valids img {
      height: 15px;
      width: 15px;
    }

    .valids p {
      padding: 0px;
      margin: 0px 5px 0px 0px;
      font-size: var(--p-valids);
      font-family: OpensansBold;
      color: #333333;
    }

    .objectfirstvalue {
      @apply(--layout-horizontal);
      @apply(--layout-center);
      width: 80%;
      overflow: hidden;
      white-space: nowrap;
      text-overflow:ellipsis;
    }

    .objectfirstvalue p {
      width: 100%;
      text-align: left;
      margin: 0px;
      padding: 0px;
      font-family: Opensans;
      font-size: var(--p-size);
      color: #666666;
      overflow: hidden;
      white-space: nowrap;
      text-overflow:ellipsis;
    }

    .whitecanvas {
      background-color: white;
      width: 100%;
      height: 100%;
    }

    .avatarcanvas {
      background: linear-gradient(to bottom, #a4facd 60%, white 40% ); 
      width: 100%;
      height: 100vw;
      max-height: 400px;
      @apply(--layout-vertical);
      @apply(--layout-center);
    }

    lo-peers {
      width: 75px;
      height: 75px;
      background-color: transparent;
      margin: 30px 0px 30px 0px;
    }

    .valuesbox {
      background-color: #F4F4F4;
      width: 100%;
      margin: 0px;
      @apply(--layout-vertical);
      @apply(--layout-start); 
    }

    .values {
      width: 100%;
      height: 100%;
      padding: 20px 25px 25px 25px;
      box-sizing:border-box;
      text-align: center;
    }

    .values p {
      text-align: center;
      margin: 0px;
      padding: 0px;
      font-family: Opensans;
      font-size: 16px;
      color: #666666;
    }

    .lockedbtn {
      background-color: rgba(0,0,0,0.025);
      height: 75px;
      width: 75px;
      border-radius: 50%;
      border: none;
      outline: 0; 
      margin: 15px 0px 10px 0px;
    }

    .lockedbtn img {
      height: 100%;
      width: 100%;
    }

    .visualedit {
      width: 100%;
      background-color: white;
      padding: 0px 0px 0px 0px;
    }


    iron-collapse {
      width: 100%;
      @apply(--layout-vertical);
      @apply(--layout-center); 

    }



    .itemselector {
      width: 100%;
      background-color: transparent;
      @apply(--layout-vertical);
      @apply(--layout-center-center); 
    }

    #itemselector {
      width: 80%;
      @apply(--layout-horizontal);
      @apply(--layout-wrap);
      @apply(--layout-center-center); 
    }

    .item {
      width: 60px;
      height: 60px;
      margin: 0px;
      padding: 0px;
      @apply(--layout-horizontal);
      @apply(--layout-center-center); 
      opacity: 0.5;
    }

    .item img {
      width: 90%;
      height: 90%;
      margin: 0px;
      padding: 0px;
    }

    #itemselector .iron-selected {
      border: 2px solid var(--primary-lightblue);
      border-radius: 2px;
      border-radius: 50%;
      opacity: 1;
    }

    lo-colorpicker {
      width: 100%;
      height: 40px;
    }

    .navlayer {
      width: 100%;
      max-width: 500px;
      height: 100%;
      background-color: transparent;
    }

    .navlayer button {
      width: 50%;
      height: 100%;
      opacity: 0;
    }

    lo-configbtns {
      visibility: var(--btns-visibility);
    }



  </style>
  <template>

<neon-animated-pages
  id="woonstmainpages"
  selected="{{selected}}"
  entry-animation="{{entryAnimation}}"
  exit-animation="{{exitAnimation}}">

<!--   0 //   THUMB PERVIEW -->
  <neon-animatable>
    <div class="canvas layout vertical center-center">
      <div class="thumbcontainer">
        <div class="absolutepos">
          <labs002-avatar-backingpages 
            selected="{{backingselected}}"
            color="{{backingcolor}}"
            nrofitems="{{nrofbacking}}">
          </labs002-avatar-backingpages>
        </div>
        <div class="absolutepos">
          <labs002-avatar-woonstpages 
            selected="{{woonstselected}}"
            color="{{woonstcolor}}"
            nrofitems="{{nrofwoonst}}">
          </labs002-avatar-woonstpages>
        </div>
      </div>
      <div class="objectvaluesbar">
        <div class="objectfirstvalue">
          <small>{{firstvalue}}</small>
        </div>
        <div class="valids">
          <p>{{objectpeers.length}}</p>
          <img src="../../images/accept-small.svg">
        </div>
      </div>
    </div>
  </neon-animatable>

  <neon-animatable>
    <div class="canvas layout vertical center">

      <div class="avatarcanvas">
        <div class="avatarcontainer">
        <div class="thumbcontainer">
            <div class="absolutepos">
              <labs002-avatar-backingpages 
                selected="{{backingselected}}"
                color="{{backingcolor}}"
                nrofitems="{{nrofbacking}}">
              </labs002-avatar-backingpages>
            </div>
            <div class="absolutepos">
              <labs002-avatar-woonstpages 
                selected="{{woonstselected}}"
                color="{{woonstcolor}}"
                nrofitems="{{nrofwoonst}}">
              </labs002-avatar-woonstpages>
            </div>
            <div class="absolutepos">
              <div class="navlayer layout horizontal center-center">
                <lo-configbtns on-tap="previous" id="previous"></lo-configbtns>
                <button on-tap="toggleVisualedit">hier</button>
                <lo-configbtns next on-tap="next" id="next"></lo-configbtns>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div class="visualedit">
          <iron-collapse id="visualedit" opened="{{visualopen}}">
            <lo-colorpicker
              on-color-changed="_selectedcolor">
            </lo-colorpicker>
            <div class="itemselector">
              <iron-selector id="itemselector" attr-for-selected="context" selected="woonst" on-iron-select="passItem">
                <div class="item" context="woonst">
                  <img src="../../images/woonst.svg">
                </div>
                <div class="item" context="backing">
                  <img src="../../images/backing.svg">
                </div>              
              </iron-selector>
            </div>
          </iron-collapse>
        </div>
        <div class="valuesbox" on-tap="toggleValuesedit">
          <div class="values">
            <p><span>{{firstvalue}}</span></p>    
            <iron-collapse id="valuesedit">
              <template is="dom-repeat" items="{{previewdata}}">
                <p><span>{{item}}</span><span>{{item.value}}</span></p>
              </template>
              <button class="lockedbtn" on-tap="toEdit">
                <img src="../../images/locked.svg">
              </button>
            </iron-collapse>
          </div>
        </div>
      <lo-peers peers="{{objectpeers}}" on-go-back="_toBack" valcolor="var(--primary-green)"></lo-peers>
    </div>
  </neon-animatable>



  <neon-animatable>
    <div class="canvas layout vertical center">

      <div class="valuesfull">
        <div class="values">
          <paper-input-container>
            <label>Straat</label>
            <input autofocus type="text" is="iron-input" bind-value="{{objectdata.straat}}">
          </paper-input-container>
          <paper-input-container>
            <label>Nummer</label>
            <input type="text" is="iron-input" bind-value="{{objectdata.nummer}}">
          </paper-input-container>
          <paper-input-container>
            <label>Plaats</label>
            <input type="text" is="iron-input" bind-value="{{objectdata.plaats}}" >
          </paper-input-container>
          <paper-input-container>
            <label>Postcode</label>
            <input type="text" is="iron-input" bind-value="{{objectdata.postcode}}" >
          </paper-input-container>
          <button on-tap="save">SAVE VALUES</button>
        </div>
      </div>
    </div>
  </neon-animatable>




</neon-animated-pages>

  </template>
  <script>
  (function() {
    Polymer({
      is: 'labs002-woonst',

      behaviors: [
      Polymer.NeonAnimatableBehavior
      ],

      properties: {
        objectconfig: {
          type: Object,
          notify: true,
          observer: "_configChanged"
        },

        objectdata: {
          type: Object,
          notify: true,
          observer: "_dataChanged"
        },

        edit: {
          type: Boolean,
          value: false,
          observer: "_editChanged"
        },

        opened: {
          type: Boolean,
          value: false
        },

        objecthash: {
          type: String
        },

        modus: {     
          type: Number,
          value: 0,
          notify: true,
          observer: "_modusChanged"        
        },


      },


      ready: function(){
        this.$.woonstmainpages.selected = 0;
      },


      attached: function() {
        this.async(function() {
        this._configChanged();
        this._dataChanged();
      });

      this.entryAnimation = 'fade-in-animation';
      this.exitAnimation = 'fade-out-animation';
      },

      detached: function() {
        this.async(function() {
          //console.log(this.localName + '#' + this.id + ' was detached');
       });
      },




    previous: function(e){
        this.selecteditem = e.target.context;
        var item = document.getElementById(this.selecteditem);
        console.log("PREV: nr of items: ",item.nrofitems, " current item: ",this.objectconfig[this.selecteditem][0]);
         if(this.objectconfig[this.selecteditem][0]>=1){
          console.log(this.objectconfig[this.selecteditem][0]);
          this.objectconfig[this.selecteditem][0]--;
          e.target.active = true;
        } else {
          e.target.active = false;
        };
        this._configChanged();
        item.entryAnimation = "slide-to-left-animation";
        item.exitAnimation = "slide-right-animation";
      },

      next: function(e){
        this.selecteditem = e.target.context;
        var item = document.getElementById(this.selecteditem);
        console.log(item);
        console.log("NEXT: nr of items: ",item.nrofitems, " current item: ",this.objectconfig[this.selecteditem][0]);
        if(this.objectconfig[this.selecteditem][0]<=item.nrofitems-1){
          console.log(this.objectconfig[this.selecteditem][0]);
          this.objectconfig[this.selecteditem][0]++;
          e.target.active = true;
        } else {
          e.target.active = false;
        };
        this._configChanged();
        item.entryAnimation = "slide-to-right-animation";
        item.exitAnimation = "slide-left-animation";
      },







_configChanged: function(){

        this.setButtonstates(this.selecteditem);

        this.nrof = [];

        this.nrof['woonst'] = this.nrofwoonst; 
        this.nrof['backing'] = this.nrofbacking; 

        this.woonstselected = this.objectconfig.woonst[0];
        this.woonstcolor = this.objectconfig.woonst[1];

        this.backingselected = this.objectconfig.backing[0];
        this.backingcolor = this.objectconfig.backing[1];
      },


      _dataChanged: function(){
        //console.log('Avatar data changed: ', this.objectdata);
        this.straat = this.objectdata.straat;
        this.nummer = this.objectdata.nummer;
        this.postcode = this.objectdata.postcode;
        this.plaats = this.objectdata.plaats;
        this.locked = this.objectdata.locked;
      },

      unlock: function(){
        this.locked = false;
      },


      _selectedcolor: function(){
        if(this.objectconfig){
          var item = this.selecteditem;
          var color = this.selectedcolor;
          this.objectconfig[item][1] = color;
          var avataritem = document.getElementById(item);
          avataritem.color = color;
          this._configChanged();
        };
      },


      editListener: function(){
          if(this.opened){
          this.selected = 1;
          } else {
            this.selected = 0;
          }; 
      },

      _modusChanged: function(){
        switch(this.modus){

          case 0:
            this.$.woonstmainpages.selected = this.modus;
          break;

          case 1:
            this.$.woonstmainpages.selected = this.modus;
          break;

          case 2:
            this.$.woonstmainpages.selected = this.modus;
          break;

          case 3:
            this.$.woonstmainpages.selected = this.modus;
          break;

        };
      },


      toEdit:function(){
        this.modus = 2;
      },


    toggleValuesedit:function(){
      this.$.valuesedit.toggle();
    },


    toggleVisualedit:function(){
      this.$.visualedit.toggle();
      if (this.visualopen) { 
        this.customStyle['--btns-visibility'] = 'show';
        this.updateStyles(); 
      } else {
        this.customStyle['--btns-visibility'] = 'hidden';
        this.updateStyles(); 
        // this.save();
      }
    },

      save:function(){
        this.fire('save-it', { datasetkey: this.objectname, dataset: this.objectdata, hash: this.objecthash, config: this.objectconfig });
        this.modus = 1;
      },

      passItem:function(){
        // hier dus een nieuwe functie die gaat checken of de prev/next buttons actief zijn of niet.
        var selecteditem = this.$.itemselector.selected;
        this.setButtonstates(selecteditem);
      },

      setButtonstates: function(selecteditem){
        if(selecteditem){
          var max = this.nrof[selecteditem];
          var cur = this.objectconfig[selecteditem][0];

          if(cur>=0&&cur<=max){
            this.$.next.active = true;
            this.$.previous.active = true;
          };

          if(cur==max){
            this.$.next.active = false;
            this.$.previous.active = true;
          };

          if(cur<=0){
            this.$.previous.active = false;
          };

        }; 
      },

      previous: function(e){
        var selecteditem = this.$.itemselector.selected;
        //var item = document.getElementById(this.selecteditem);
        if(this.objectconfig[selecteditem][0]>=0&&this.$.previous.active){
          this.objectconfig[selecteditem][0]--;
          this.setButtonstates(selecteditem);
        } else {
          this.setButtonstates(selecteditem);
        };
        this._configChanged();
          //item.entryAnimation = "slide-to-left-animation";
          //item.exitAnimation = "slide-right-animation";
        },

        next: function(e){
          var selecteditem = this.$.itemselector.selected;
          if(this.objectconfig[selecteditem][0]<=this.nrof[selecteditem]&&this.$.next.active){
            this.objectconfig[selecteditem][0]++;
            this.setButtonstates(selecteditem);
          } else {
            this.setButtonstates(selecteditem);
          };
          this._configChanged();
          //item.entryAnimation = "slide-to-right-animation";
          //item.exitAnimation = "slide-left-animation";
        },







    });
  })();
  </script>
</dom-module>










